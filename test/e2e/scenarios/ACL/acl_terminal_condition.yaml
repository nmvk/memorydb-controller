id: "ACL_CREATE_UPDATE"
description: "In this test we create User and create/update ACL"
#marks:
#  - slow
#  - blocked
resources:
  -
    resource:
      apiVersion: $CRD_GROUP/$CRD_VERSION
      kind: User
      metadata:
        name: userone$RANDOM_SUFFIX
    steps:
      - id: "USER_ONE_CREATE"
        description: "Create User One"
        create:
          spec:
            userName: userone$RANDOM_SUFFIX
            accessString: on +get
            authenticationMode:
              type_: password
              passwords:
                - key: password
                  name: $SECRET1
        wait:
          status:
            conditions:
              ACK.ResourceSynced:
                status: "True"
                timeout: 100
  -
      resource:
        apiVersion: $CRD_GROUP/$CRD_VERSION
        kind: ACL
        metadata:
          name: acl$RANDOM_SUFFIX
      steps:
        - id: "ACL_CREATE"
          description: "Create new ACL"
          create:
            spec:
              aclName: acl$RANDOM_SUFFIX
              userNames:
                - invaliduser
          wait:
            status:
              conditions:
                ACK.Terminal:
                  status: "True"
                  timeout: 100
        - id: "UPDATE_ACL"
          description: "Update userNames"
          patch:
            spec:
              userNames:
                - userone$RANDOM_SUFFIX
          wait:
            status:
              conditions:
                ACK.ResourceSynced:
                  status: "True"
                  timeout: 100
        - id: "UPDATE_ACL"
          description: "Update userNames to invalid"
          patch:
            spec:
              userNames:
                - invalidusername
          wait:
            status:
              conditions:
                ACK.Terminal:
                  status: "True"
                  timeout: 100
        - id: "ACL_DELETE"
          description: "Delete ACL"
          delete: acl$RANDOM_SUFFIX
  - resource:
      apiVersion: $CRD_GROUP/$CRD_VERSION
      kind: User
      metadata:
        name: userone$RANDOM_SUFFIX
      steps:
        - id: "USER_DELETE_ONE"
          description: "Delete User one"
          delete: userone$RANDOM_SUFFIX